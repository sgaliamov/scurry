version: 0.1.{build}

image: Visual Studio 2017

clone_depth: 1

environment:
  OpenCoverToken:
    secure: rJrOmfdpmHx8EdfB7nBpijgy1H9vGRXi8jARISWwUrXeZGxTiEnHmr1c2e6BARni

dotnet_csproj:
  patch: true
  file: SCurry\SCurry.csproj
  version: '{version}'
  package_version: '{version}'
  assembly_version: '{version}'
  file_version: '{version}'

before_build:
- pwsh: msbuild .\SCurry.sln /v:m /m /t:Restore

configuration: Release

build:
  project: SCurry.sln
  parallel: true
  verbosity: minimal

#before_test:
#- pwsh: |
#    nuget install OpenCover -Verbosity quiet -Version 4.6.519
#    $env:PATH = "C:\msys64\usr\bin;" + $env:PATH
#
#test_script:
#- pwsh: |
#    Get-ChildItem .\**\*.Tests.csproj -Recurse | % {
#        .\OpenCover.4.6.519\tools\OpenCover.Console.exe `
#            -register:user `
#            -target:"C:\Program Files\dotnet\dotnet.exe" `
#            -targetargs:"test $_ --no-build" `
#            -output:"coverage.xml" `
#            -oldstyle
#        bash .build\codecov.sh -f "coverage.xml" -t $env:OpenCoverToken
#    }

# test: off

deploy_script:
- pwsh: |
    if ($env:APPVEYOR_REPO_BRANCH -eq "feature/actions") {
        dotnet pack .\SCurry\ --include-source --include-symbols --no-build --no-dependencies
        Get-ChildItem ".\SCurry\**\*.nupkg" -Recurse | % { Push-AppveyorArtifact $_.FullName -FileName $_.Name }
    }